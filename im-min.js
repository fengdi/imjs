//im.js v1.1 2013-02-22T12:43:48.482Z
(function(m){function r(b,c){var a=this;a.file=b;a.state=z;a.deps=c||[];a.factory=q;a.exports=q;a._on={};a.on=function(b,c){a._on[b]=a._on[b]||[];c?a._on[b].push(c):g(a._on[b],function(b){b.call(a)})};a.on("load",function(){a.state<v&&(a.state=v)});a.on("save",function(){a.state=w;h.checkCycle(a.file);a.loadDeps(function(){a.state=A;a.compile.apply(a,arguments)})})}var q=void 0,k=document,j=[],g=j.forEach?function(b,c){b.forEach(c)}:function(b,c){for(var a=0,d=b.length;a<d;a++)c(b[a],a,b)},B=j.indexOf?
function(b,c){return b.indexOf(c)}:function(b,c){for(var a=0,d=b.length;a<d;a++)if(c===b[a])return a;return-1},s=function(){},t=function(b,c){for(var a in c)b[a]=c[a];return b},l=function(b,c){var a={}.toString,a=null===b?"null":b===q&&"undefined"||a.call(b).slice(8,-1).toLowerCase();return c?a===c:a},u=function(b,c){if("console"in m)console[c||"log"](b)},n={normalize:function(b){var c="";b=b.replace(/^\w+:\/\/\/?/,function(a){c=a;return""});if(-1===b.indexOf("."))return c+b;var a=b.split("/"),d=
[];g(a,function(a){if(""!=a)if(".."===a){if(0===d.length)throw Error("The path is invalid: "+b);d.pop()}else"."!==a&&d.push(a)});return c+d.join("/").replace(":80/","/")},dirname:function(b){return!b.match(/\//)?"./":b.replace(/\/[^\/]+\/?$/g,"")},isAP:function(b){return!!b.match(/^\w+:\/\//)}},z=1,w=2,v=3,A=4,x={tag:"?t="+ +new Date},y=function(){if(k.currentScript)return k.currentScript.src;for(var b=k.getElementsByTagName("script"),c=b.length-1;-1<c;c--)if("interactive"===b[c].readyState)return b[c].src;
var a;try{arguments.length()}catch(d){a=d.stack||m.opera&&((d+"").match(/of linked script \S+/g)||[]).join(" ")}a=a.split(/[@ ]/g).pop();return a.replace(/(:\d+)?:\d+(\s)?$/i,"")},p=y(),j=(location.href+"").replace(/(\?|#).*$/i,""),j=j.match(/\/|\\$/g)?j+"i":j,p=n.isAP(p)?p:n.dirname(j)+"/"+p;t(r.prototype,{load:function(){var b=this,c=k.getElementsByTagName("head")[0]||k.documentElement,a=k.createElement("script");a.type="text/javascript";a.async="async";a.src=b.file;a.onerror=function(){h.remove(b.file)};
a.onload=a.onreadystatechange=function(){if(!a.readyState||/loaded|complete/.test(a.readyState))b.on("load"),a&&(a.onerror=a.onload=a.onreadystatechange=null),c&&a&&a.parentNode&&c.removeChild(a),a=q};c.insertBefore(a,c.firstChild)},compile:function(){var b=this.factory;this.exports=l(b,"function")?b.apply({},arguments):b;this.state=5;this.on("compile")},loadDeps:function(b){h.load(this.deps,b)}});var h={data:{},set:function(b,c){this.data[b]=c},get:function(b){return this.data[b]},remove:function(b){delete this.data[b]},
checkCycle:function(b,c){var a=this,d;d=a.data[b];c=c||[];d&&(d=l(d.deps,"array")?d.deps:[d.deps],d=a.realpaths(d),g(d,function(b){-1==B(c,b)?(c.push(b),a.checkCycle(b,c)):(c.push(c[0]),u("Circular dependencies:\r\n"+c.join(" >>\r\n"),"error"))}))},exports:function(b){var c=this,a=[];g(b,function(b){b=c.get(b);a.push(b&&b.exports)});return a},isOk:function(b){var c=this,a=1;g(b,function(b){b=c.data[b];if(!b||5>b.state)a=0});return a},realpaths:function(b){var c=[];l(b,"array")||(b=[b]);g(b,function(a){a=
(a||"").replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,"");n.isAP(a)||(a=n.normalize(n.dirname(p)+"/"+a));/\.js$/.test(a)||(a+=".js");a+=x.tag||"";c.push(a)});return c},load:function(b,c){var a=this,d=!1;b=a.realpaths(b);0==b.length?c():g(b,function(e){var f=a.get(e);f||(f=new r(e),setTimeout(function(){f.load()},1),a.set(e,f));if(5>f.state)f.on("compile",function(){a.isOk(b)&&c.apply(m,a.exports(b))});else a.isOk(b)&&!d&&(d=!0,c.apply(m,a.exports(b)))})}};t(m,{define:function(b,c){var a=arguments,d=y(),
e=[],f=s;1==a.length?f=b:(e=b,f=c);(a=h.get(d))?(a.deps=e,a.factory=f,a.on("save")):u("Can't find module:"+d,"error")},require:function(b,c){if(1<arguments.length)h.load(b||[],function(){(c||s).apply(this,arguments)});else if(l(b,"array")||l(b,"string"))h.load(b||[],s);else if(l(b,"function"))return b()},defines:function(b){var c=[];g(b,function(a){var b=h.realpaths(a.uri)[0],e=new r(b);h.set(b,e);e.deps=a.deps||[];e.factory=a.factory;c.push(e)});g(c,function(a){if(a.state<w)a.on("save")})},Im:{modules:h.data,
im:"1.1",log:u,config:function(b){return t(x,b||{})}}})})(this);
