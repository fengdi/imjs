{"version":3,"file":"im.module.js","sources":["../im.js"],"sourcesContent":["/*\r\n ______                                  \r\n/\\__  _\\                    __           \r\n\\/_/\\ \\/     ___ ___       /\\_\\    ____  \r\n   \\ \\ \\   /' __` __`\\     \\/\\ \\  /',__\\ \r\n    \\_\\ \\__/\\ \\/\\ \\/\\ \\  __ \\ \\ \\/\\__, `\\\r\n    /\\_____\\ \\_\\ \\_\\ \\_\\/\\_\\_\\ \\ \\/\\____/\r\n    \\/_____/\\/_/\\/_/\\/_/\\/_/\\ \\_\\ \\/___/ \r\n                           \\ \\____/      \r\n                            \\/___/      \r\n*/\r\n\r\n(function(host) {\r\n  const o2s = {}.toString;\r\n  const isFun = f => {\r\n    return o2s.call(f) === \"[object Function]\";\r\n  };\r\n  const doc = document;\r\n  const head = doc.getElementsByTagName(\"head\")[0] || doc.documentElement;\r\n  const isAbsolute = path => {\r\n    return /^(?:\\/|\\w+:)/.test(path);\r\n  };\r\n  const normalize = path => {\r\n    path = path.replace(/\\\\/g, \"/\").replace(/\\/{2,}/g, \"/\");\r\n    var parts = path.split(\"/\"),\r\n      absolute = isAbsolute(path),\r\n      prefix = \"\";\r\n    if (absolute) prefix = parts.shift() + \"//\";\r\n    for (var i = 0; i < parts.length; ) {\r\n      if (parts[i] === \"..\") {\r\n        if (i > 0 && parts[i - 1] !== \"..\") parts.splice(--i, 2);\r\n        else if (absolute) parts.splice(i, 1);\r\n        else ++i;\r\n      } else if (parts[i] === \".\") parts.splice(i, 1);\r\n      else ++i;\r\n    }\r\n    return prefix + parts.join(\"/\");\r\n  };\r\n  const dirname = path => {\r\n    if (!path.match(/\\//)) {\r\n      return (path = \"./\");\r\n    }\r\n    return path.replace(/\\/[^\\/]+?$/g, \"/\");\r\n  };\r\n  const realpath = (dir, id) => {\r\n    id = /\\.js$/.test(id) ? id : `${id}.js`;\r\n    return normalize(dir + \"/\" + id);\r\n  };\r\n  const modules = {\r\n    // 'a' : {id:'a', deps:[], factory:(function(){}), path:'', export:null}\r\n  };\r\n  const define = function(id, deps, factory) {\r\n    const args = arguments;\r\n    let i, d, f;\r\n    const curScript = doc.currentScript;\r\n    const imId = curScript && curScript.$imId;\r\n    const path = curScript && curScript.src;\r\n    if (args.length == 1) {\r\n      [i, d, f] = [imId, [], id];\r\n    } else if (args.length == 2) {\r\n      [i, d, f] = [imId, id, deps];\r\n    } else if (args.length == 3) {\r\n      [i, d, f] = [id, deps, factory];\r\n    } else {\r\n      throw new Error(\"Arguments error.\");\r\n    }\r\n\r\n    modules[i] = { id: i, deps: d, factory: f, path };\r\n  };\r\n  const loadScript = function(url) {\r\n    return new Promise((resolve, reject) => {\r\n      var script = doc.createElement(\"script\");\r\n      script.addEventListener(\r\n        \"load\",\r\n        e => {\r\n          resolve(modules[url]);\r\n        },\r\n        { once: true }\r\n      );\r\n      script.addEventListener(\r\n        \"error\",\r\n        e => {\r\n          reject(`Not Found Module: ${url}`);\r\n        },\r\n        { once: true }\r\n      );\r\n      script.$imId = url;\r\n      script.src = url.trim();\r\n      head.insertBefore(script, head.firstChild);\r\n    });\r\n  };\r\n  const require = async function(id, callback) {\r\n    id = isAbsolute(id) ? id : realpath(require.root, id);\r\n\r\n    let module = modules[id] || (await loadScript(id));\r\n\r\n    const { deps = [], factory } = module;\r\n\r\n    if (\"export\" in module) {\r\n      return module.export;\r\n    } else {\r\n      module.export = factory.apply(\r\n        host,\r\n        (await Promise.all(\r\n          deps.map(id => {\r\n            return require(realpath(dirname(module.path), id));\r\n          })\r\n        )) || []\r\n      );\r\n      isFun(callback) && callback(module.export);\r\n      return module.export;\r\n    }\r\n  };\r\n\r\n  define.amd = true;\r\n\r\n  host.define = define;\r\n\r\n  host.require = require;\r\n\r\n  host.modules = modules;\r\n\r\n  require.root = dirname(window.location.href);\r\n})(window);\r\n"],"names":["host","o2s","isFun","doc","head","isAbsolute","dirname","realpath","modules","define","require","window","toString","f","call","document","getElementsByTagName","documentElement","path","test","match","replace","dir","id","parts","split","absolute","prefix","shift","i","length","splice","join","normalize","callback","module","factory","export","apply","Promise","all","deps","map","_Promise$all","root","url","resolve","reject","script","createElement","addEventListener","e","once","$imId","src","trim","insertBefore","firstChild","d","args","arguments","curScript","currentScript","imId","Error","amd","location","href"],"mappings":"AAYA,IAAUA,EACFC,EACAC,EAGAC,EACAC,EACAC,EAmBAC,EAMAC,EAIAC,EAGAC,EAwCAC,EA/EEV,EA+GPW,OA9GKV,EAAM,GAAGW,SACTV,WAAQW,SACW,sBAAhBZ,EAAIa,KAAKD,IAEZV,EAAMY,SACNX,EAAOD,EAAIa,qBAAqB,QAAQ,IAAMb,EAAIc,gBAClDZ,WAAaa,SACV,eAAeC,KAAKD,IAkBvBZ,WAAUY,UACTA,EAAKE,MAAM,MAGTF,EAAKG,QAAQ,cAAe,KAFlB,MAIbd,WAAYe,EAAKC,mBAtBLL,OAEZM,GADJN,EAAOA,EAAKG,QAAQ,MAAO,KAAKA,QAAQ,UAAW,MAClCI,MAAM,KACrBC,EAAWrB,EAAWa,GACtBS,EAAS,GACPD,IAAUC,EAASH,EAAMI,QAAU,UAClC,IAAIC,EAAI,EAAGA,EAAIL,EAAMM,QACP,OAAbN,EAAMK,GACJA,EAAI,GAAsB,OAAjBL,EAAMK,EAAI,GAAaL,EAAMO,SAASF,EAAG,GAC7CH,EAAUF,EAAMO,OAAOF,EAAG,KAC5BA,EACe,MAAbL,EAAMK,GAAYL,EAAMO,OAAOF,EAAG,KACtCA,SAEFF,EAASH,EAAMQ,KAAK,KAUpBC,CAAUX,EAAM,KADvBC,EAAK,QAAQJ,KAAKI,GAAMA,EAAQA,WAG5Bf,EAAU,GA2CVE,WAAyBa,EAAIW,kBAG7BC,+BAEW,IAAIC,mBAEf,WAAYD,SACPA,EAAOE,aAEED,EAAQE,6BAEfC,QAAQC,IACbC,EAAKC,aAAInB,UACAb,EAAQH,EAASD,EAAQ6B,EAAOjB,MAAOK,gCAJpDY,EAAOE,cAASD,EACdpC,EACA2C,GAIM,IAERzC,EAAMgC,IAAaA,EAASC,EAAOE,QAC5BF,EAAOE,SAlBhBd,EAAKlB,EAAWkB,GAAMA,EAAKhB,EAASG,EAAQkC,KAAMrB,SAErCf,EAAQe,kDAzBKsB,EAyBoBtB,EAxBvC,IAAIgB,iBAASO,EAASC,OACvBC,EAAS7C,EAAI8C,cAAc,UAC/BD,EAAOE,iBACL,gBACAC,GACEL,EAAQtC,EAAQqC,KAElB,CAAEO,MAAM,IAEVJ,EAAOE,iBACL,iBACAC,GACEJ,uBAA4BF,IAE9B,CAAEO,MAAM,IAEVJ,EAAOK,MAAQR,EACfG,EAAOM,IAAMT,EAAIU,OACjBnD,EAAKoD,aAAaR,EAAQ5C,EAAKqD,2DAnBhB,IAASZ,IAlBtBpC,EAAS,SAASc,EAAIkB,EAAML,aAE5BP,EAAG6B,EAAG7C,EADJ8C,EAAOC,UAEPC,EAAY1D,EAAI2D,cAChBC,EAAOF,GAAaA,EAAUR,MAC9BnC,EAAO2C,GAAaA,EAAUP,OACjB,GAAfK,EAAK7B,OACND,KAAW,CAACkC,EAAM,GAAIxC,OAAnBmC,OAAG7C,YACF,GAAmB,GAAf8C,EAAK7B,OACbD,KAAW,CAACkC,EAAMxC,EAAIkB,OAAnBiB,OAAG7C,WACF,CAAA,GAAmB,GAAf8C,EAAK7B,aAGR,IAAIkC,MAAM,oBAFfnC,KAAW,CAACN,EAAIkB,EAAML,OAAnBsB,OAAG7C,OAKTL,EAAQqB,GAAK,CAAEN,GAAIM,EAAGY,KAAMiB,EAAGtB,QAASvB,OAAGK,KA+CtC+C,KAAM,EAEbjE,EAAKS,OAASA,EAEdT,EAAKU,QAAUA,EAEfV,EAAKQ,QAAUA,EAEfE,EAAQkC,KAAOtC,EAAQK,OAAOuD,SAASC"}